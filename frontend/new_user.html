<html>
	<head>
		<title>Arcano</title>

		<!-- jQuery -->
		 <script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"> </script>
         <script type = "text/javascript" src = "scripts/scripts.js"> </script>

         <style>

             #container{
                 width: 100%;
             }

            #userForm {
                display:grid;
                grid-template-columns: max-content max-content max-content;
                grid-gap:5px;
                width: 80%;
                margin:auto;
            }
            #userForm label       { text-align:right; }

         </style>
	</head>
	<body>
        <h1> Arcano - Insert new user </h1>
        
        <h3><a href="index.html"> Back to dashboard </a></h3>

        <span class="prescriptions"> Username must be at least 4 characters long.</span> <br>
        <span class="prescriptions"> Password must be at least 6 characters long. </span> <br> <br>

		<div id="container">

            <div id="userForm">
                <label for="username"> Username*: </label>
                <input type="text" id="username" name="username">
                <span class="red_hints" id="username_alert"></span>

                
                <label for="name"> Name: </label>
                <input type="text" id="name" name="name">
                <span></span>

                <label for="surname">Surname:</label>
                <input type="text" id="surname" name="surname">
                <span></span>

                <label for="username"> Password*: </label>
                <input type="password" id="password" name="password">
                <span class="red_hints" id="password_alert"></span>

                <label for="password_check"> Double check password*: </label>
                <input type="password" id="password_check" name="password_check">
                <span></span>

                <span></span><span></span>
                <button type="button" id="submit">Submit</button>

            </div>

        </div>

        <script>
            $('#submit').click(submitData);

            function getValueFromElementById(element_id){
                var value = document.getElementById(element_id).value;
                return $.trim(value);
            }

            function valueIsEmptyOrNull(value) {
                return value === undefined || value === "";
            }

            function isLengthAtLeast(value, minLength){
                return value.length >= minLength;
            }

            function passwordsAreTheSame(psswOne, psswTwo){
                return psswOne === psswTwo;
            }

            function checkUsername(){
                var username = getValueFromElementById("username");
                
                if(valueIsEmptyOrNull(username)) {
                    document.getElementById("username_alert").innerText = "Required";
                    return false;
                }

                if(!isLengthAtLeast(username, 4)) {
                    document.getElementById("username_alert").innerText = "At least 4 chars";
                    return false;
                }
                return true;
            }

            function checkPassword(){
                var pass_first = getValueFromElementById("password");
                var pass_second = getValueFromElementById("password_check");
                
                if(valueIsEmptyOrNull(pass_first) || valueIsEmptyOrNull(pass_second)) {
                    document.getElementById("password_alert").innerText = "Both fields are required";
                    return false;
                }

                if(!isLengthAtLeast(pass_first, 6)) {
                    document.getElementById("password_alert").innerText = "At least 6 chars";
                    return false;
                }
                
                if(!passwordsAreTheSame(pass_first, pass_second)) {
                    document.getElementById("password_alert").innerText = "Passwords are not the same.";
                    return false;
                }

                return true;
            }

            function submitData(){
                
                if(checkUsername() && checkPassword()){
                    console.log("Values are ok, sending")

                    var request_body = {
                            username : getValueFromElementById("username"),
                            name: getValueFromElementById("name"),
                            surname: getValueFromElementById("surname"),
                            password: getValueFromElementById("password"),
                            role: "PLAYER"
                        };

                    $.ajax({
                        url: ENDPOINT_URL + "/users",
                        contentType: "application/json",
                        dataType: 'json',
                        type: 'POST',
                        data: JSON.stringify(request_body),
                        success: function (result) {
                            alert("Successfully registered.");
                        },
                        error: function (result) {
                            console.log(result);
                            if(result.status == 409){
                                alert("Username already in use.");
                            } else if (result.status == 500){
                                alert("Server has encountered a problem, contact an admin.");
                            } else {
                                alert("Cannot estabilish a connection with the server.");
                            }
                        }
                    });
                    
                }

            }
        </script>
    </body>
        
    </html>